---
import type { ResponsiveImage } from '@/types/content';
import dayjs from 'dayjs';

interface Props {
  title: string;
  href: string;
  thumbnail?: { responsiveImage: ResponsiveImage };
  date?: Date | string;
  tags?: string;
  type: 'article' | 'project';
  external?: boolean;
  transitionName?: string;
}

const { title, href, thumbnail, date, tags, type, external = false, transitionName } = Astro.props;

const meta = (() => {
  let desc = '';
  if (type === 'article' && date) {
    desc = `${dayjs(date as string).format('MMM YYYY')} Â· `;
  }
  if (tags) desc += tags;
  return desc;
})();
---

<a
  href={href}
  class="card flex flex-col h-full cursor-pointer group rounded-xl bg-[var(--bg-elevated)] border border-[var(--border-hover)] p-3 hover:border-[var(--accent)]/30 transition-all duration-400"
  {...(external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
>
  {thumbnail?.responsiveImage && (
    <div class="overflow-hidden rounded-lg aspect-[4/3] bg-[var(--bg-surface)]" transition:name={transitionName}>
      <img
        src={thumbnail.responsiveImage.src}
        srcset={thumbnail.responsiveImage.srcSet}
        sizes={thumbnail.responsiveImage.sizes}
        width={thumbnail.responsiveImage.width}
        height={thumbnail.responsiveImage.height}
        alt={thumbnail.responsiveImage.alt || title}
        loading="lazy"
        decoding="async"
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.03]"
        style={thumbnail.responsiveImage.base64 ? `background-image: url(${thumbnail.responsiveImage.base64}); background-size: cover;` : ''}
      />
    </div>
  )}
  <div class="pt-4 pb-1 px-1 flex-1 flex flex-col">
    <h2 class="font-display font-semibold text-lg text-[var(--text)] group-hover:text-[var(--accent)] transition-colors duration-300">
      {title}
    </h2>
    {meta && (
      <p class="text-[var(--text-muted)] font-body text-sm mt-auto pt-2">
        {meta}
      </p>
    )}
  </div>
</a>

<script>
  document.querySelectorAll<HTMLElement>('.card').forEach((card) => {
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width) * 100;
      const y = ((e.clientY - rect.top) / rect.height) * 100;
      card.style.setProperty('--card-mx', `${x}%`);
      card.style.setProperty('--card-my', `${y}%`);
    });
    card.addEventListener('mouseleave', () => {
      card.style.setProperty('--card-mx', '50%');
      card.style.setProperty('--card-my', '50%');
    });
  });
</script>
